(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var e=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.$el="string"==typeof t?document.querySelector(t):t}var r,o;return r=e,(o=[{key:"html",value:function(t){return"string"==typeof t?(this.$el.innerHTML=t,this):this.$el.outerHTML.trim()}},{key:"append",value:function(t){return t instanceof e&&(t=t.$el),Element.prototype.append?this.$el.append(t):this.$el.appendChild(t),this}},{key:"text",value:function(t){return void 0!==t?(this.$el.textContent=t,this):"input"===this.$el.tagName.toLowerCase()||"textarea"===this.$el.tagName.toLowerCase()?this.$el.value.trim():this.$el.textContent.trim()}},{key:"clear",value:function(){return"input"===this.$el.tagName.toLowerCase()?(this.$el.value="",this):(this.$el.textContent="",this)}},{key:"blur",value:function(){this.$el.blur()}},{key:"data",get:function(){return this.$el.dataset}},{key:"on",value:function(t,e){this.$el.addEventListener(t,e)}},{key:"closest",value:function(t){return n(this.$el.closest(t))}},{key:"off",value:function(t,e){this.$el.removeEventListener(t,e)}},{key:"find",value:function(t){return n(this.$el.querySelector(t))}},{key:"css",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(e).forEach((function(n){t.$el.style[n]=e[n]}))}},{key:"addClass",value:function(t){return this.$el.classList.add(t),this}},{key:"removeClass",value:function(t){return this.$el.classList.remove(t),this}}])&&t(r.prototype,o),e}();function n(t){return new e(t)}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}n.create=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=document.createElement(t);return e&&r.classList.add(e),n(r)};var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.listeners={}}var e,n;return e=t,(n=[{key:"emit",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return!!Array.isArray(this.listeners[t])&&(this.listeners[t].forEach((function(t){t.apply(void 0,n)})),!0)}},{key:"subscribe",value:function(t,e){var n=this;return this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(e),function(){n.listeners[t]=n.listeners[t].filter((function(t){return t!==e}))}}}])&&r(e.prototype,n),t}();function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e?localStorage.setItem(t,JSON.stringify(e)):JSON.parse(localStorage.getItem(t))}function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.store=e,this.sub=null,this.prevState={}}var e,n;return e=t,(n=[{key:"subscribeComponents",value:function(t){var e=this;this.prevState=this.store.getState(),this.sub=this.store.subscribe((function(n){Object.keys(n).forEach((function(r){var o,a;o=e.prevState[r],a=n[r],("object"===i(o)&&"object"===i(a)?JSON.stringify(o)===JSON.stringify(a):o===a)||t.forEach((function(t){if(t.isWatching(r)){var e=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},r,n[r]);t.storeChanged(e)}}))})),e.prevState=e.store.getState()}))}},{key:"unsubscribeFromStore",value:function(){this.sub.unsubscribe()}}])&&s(e.prototype,n),t}();function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var l=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.$el=n(e),this.components=r.components||[],this.store=r.store,this.emitter=new o,this.subscriber=new c(this.store)}var e,r;return e=t,(r=[{key:"getRoot",value:function(){var t=n.create("div","todo"),e={emitter:this.emitter,store:this.store};return this.components=this.components.map((function(r){var o=n.create("div",r.className),i=new r(o,e);return o.html(i.toHTML()),t.append(o),i})),t}},{key:"render",value:function(){this.$el.append(this.getRoot()),this.subscriber.subscribeComponents(this.components),this.components.forEach((function(t){return t.init()}))}},{key:"destroy",value:function(){this.subscriber.unsubscribeFromStore(),this.components.forEach((function(t){return t.destroy}))}}])&&u(e.prototype,r),t}();function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function y(t){return"on"+("string"!=typeof(e=t)?"":e.charAt(0).toUpperCase()+e.slice(1));var e}function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function m(t,e){return!e||"object"!==b(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var O=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(a,t);var e,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=k(r);if(o){var n=k(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return m(this,t)});function a(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,a),(e=i.call(this,t,n.listeners)).name=n.name||"",e.emitter=n.emitter,e.subscribe=n.subscribe||[],e.store=n.store,e.unsubscribers=[],e.storeSub=null,e.prepare(),e}return e=a,(n=[{key:"prepare",value:function(){}},{key:"toHTML",value:function(){return""}},{key:"$emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=this.emitter).emit.apply(e,[t].concat(r))}},{key:"$on",value:function(t,e){var n=this.emitter.subscribe(t,e);this.unsubscribers.push(n)}},{key:"$dispatch",value:function(t){this.store.dispatch(t)}},{key:"storeChanged",value:function(){}},{key:"isWatching",value:function(t){return this.subscribe.includes(t)}},{key:"init",value:function(){this.initDOMListeners()}},{key:"reRender",value:function(){this.$root.html(this.toHTML())}},{key:"destroy",value:function(){this.removeDOMListeners(),this.unsubscribers.forEach((function(t){return t()})),this.storeSub.unsubscribe()}}])&&d(e.prototype,n),a}(function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(f(this,t),!e)throw new Error("No $root provided for DomListener!");this.$root=e,this.listeners=n}var e,n;return e=t,(n=[{key:"initDOMListeners",value:function(){var t=this;this.listeners.forEach((function(e){var n=y(e);if(!t[n])throw new Error("Method ".concat(n," is not implemented in ").concat(t.name," Component"));t[n]=t[n].bind(t),t.$root.on(e,t[n])}))}},{key:"removeDOMListeners",value:function(){var t=this;this.listeners.forEach((function(e){var n=y(e);t.$root.off(e,t[n])}))}}])&&p(e.prototype,n),t}()),g="CREATE_TASK",w="SWITCH_COMPLETE_STATE",j="TASK_SELECTED",S="CHANGE_TITLE",P="CHANGE_DESCRIPTION",_="DELETE_TASK";function E(t,e,n,r){return'\n    <div class="list_item '.concat(r?"active":"",'" data-task="true" data-id="').concat(t,'">\n      <div class="list_item__apply" data-button-complete="true">\n      </div>\n      <div class="list_item__inner">\n        <span class="list_item__title" data-task="true">\n          ').concat(e,'\n        </span>\n        <span class="list_item__description" data-task="true">\n          ').concat(n,"\n        </span>\n      </div>\n    </div>")}function T(t){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function D(t,e){return(D=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function I(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function L(t){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var x=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&D(t,e)}(s,t);var e,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=L(o);if(i){var n=L(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return I(this,t)});function s(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),a.call(this,t,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$(Object(n),!0).forEach((function(e){R(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({name:"List",listeners:["keypress","click"],subscribe:["tasks"]},e))}return e=s,(r=[{key:"toHTML",value:function(){return function(t){var e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[],n=[];return Object.keys(t.tasks).forEach((function(r){var o=E(r,t.tasks[r].title,t.tasks[r].description,t.currentTask===r);!0===t.tasks[r].completed?e.push(o):n.push(o)})),{completedTasks:e,uncompletedTasks:n}}(t),n=e.completedTasks,r=e.uncompletedTasks,o=n.length;return'      \n  <div class="list_header">\n    <div class="list_title">To-do list</div>\n  </div>\n\n  <input type="text"\n  placeholder="Добавить задачу"\n  class="list_add-case">\n\n  <div class="list_items">\n\n    '.concat(r.join(""),'\n\n  <div class="list_items--completed">\n\n    <div class="list_item list_item--completed">\n      Выполнено (').concat(o,")\n    </div>\n\n    ").concat(n.join(""),"\n\n  </div>\n\n  </div>")}(this.store.getState())}},{key:"createTask",value:function(t){var e=n(t.target),r={value:e.text(),taskId:("task","".concat("task",":")+Date.now().toString())};this.$dispatch(function(t){return{type:g,data:t}}(r)),e.clear().blur()}},{key:"selectTask",value:function(t){var e=this,n={taskId:t.closest("[data-id]").data.id};this.$dispatch(function(t){return{type:j,data:t}}(n));var r=this.store.getState();Object.keys(r.tasks).map((function(t){return e.$root.find('[data-id="'.concat(t,'"]'))})).forEach((function(t){t.data.id===r.currentTask?t.addClass("active"):t.removeClass("active")}))}},{key:"switchTaskState",value:function(t){var e={id:"completed",taskId:t.closest("[data-id]").data.id};this.$dispatch(function(t){return{type:w,data:t}}(e))}},{key:"storeChanged",value:function(t){this.reRender()}},{key:"onKeypress",value:function(t){"Enter"===t.key&&this.createTask(t)}},{key:"onClick",value:function(t){var e=n(t.target);"true"===e.data.buttonComplete&&this.switchTaskState(e),"true"===e.data.task&&this.selectTask(e)}}])&&C(e.prototype,r),s}(O);function N(t){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function A(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function H(t,e){return(H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function B(t,e){return!e||"object"!==N(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function J(t){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function K(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}R(x,"className","list");var W=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&H(t,e)}(s,t);var e,r,o,i,a=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=J(o);if(i){var n=J(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return B(this,t)});function s(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),a.call(this,t,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?M(Object(n),!0).forEach((function(e){K(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({name:"Toolbar",listeners:["input","click"],subscribe:["currentTask"]},e))}return e=s,(r=[{key:"toHTML",value:function(){return function(t){if(t.currentTask){var e=t.tasks[t.currentTask],n=e.title,r=e.description;return'\n    <div class="toolbar_header">\n      <div class="toolbar_icon-delete" data-delete-button="true">\n        <svg class="delete" data-delete-button="true">\n          <use xlink:href="#delete" data-delete-button="true">\n          </use>\n        </svg>\n      </div>\n    </div>\n    \n    <input\n    type="text"\n    class="toolbar_title"\n    value="'.concat(n,'"\n    data-title="true"\n    placeholder="Введите название"\n    >\n    \n    <textarea\n    type="text"\n    class="toolbar_details"\n    placeholder="Добавить описание"\n    data-description="true">').concat(r,"</textarea>\n  ")}return""}(this.store.getState())}},{key:"storeChanged",value:function(t){this.reRender()}},{key:"onInput",value:function(t){var e=n(t.target);if("true"===e.data.title){var r={taskId:this.store.getState().currentTask,value:e.text()};this.$dispatch(function(t){return{type:S,data:t}}(r))}if("true"===e.data.description){var o={taskId:this.store.getState().currentTask,value:e.text()};this.$dispatch(function(t){return{type:P,data:t}}(o))}}},{key:"onClick",value:function(t){if("true"===n(t.target).data.deleteButton&&confirm("Вы действительно хотите удалить эту таблицу?")){var e={taskId:this.store.getState().currentTask};this.$dispatch(function(t){return{type:_,data:t}}(e))}}}])&&A(e.prototype,r),s}(O);function q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?q(Object(n),!0).forEach((function(e){G(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function G(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}K(W,"className","toolbar");var U=a("todo-state")?a("todo-state"):{tasks:{},currentTask:""},z={title:"",completed:!1,description:""};function Q(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function V(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Q(Object(n),!0).forEach((function(e){X(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function X(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Y=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t(F({},e),{type:"__INIT__"}),r=[];return{subscribe:function(t){return r.push(t),{unsubscribe:function(){r=r.filter((function(e){return e!==t}))}}},dispatch:function(e){n=t(n,e),r.forEach((function(t){return t(n)}))},getState:function(){return JSON.parse(JSON.stringify(n))}}}((function(t,e){var n,r;switch(e.type){case g:return n="tasks",V(V({},t),{},X({},n,V(V({},t.tasks),{},X({},e.data.taskId,V(V({},z),{},{title:e.data.value})))));case w:return n="tasks",(r=t.tasks[e.data.taskId]||{})[e.data.id]=!1===r[e.data.id],V(V({},t),{},X({},n,V(V({},t.tasks),{},X({},e.data.taskId,V({},r)))));case j:return V(V({},t),{},{currentTask:e.data.taskId!==t.currentTask&&e.data.taskId});case S:return n="title",(r=t.tasks[e.data.taskId]||{})[n]=e.data.value,V(V({},t),{},{tasks:V(V({},t.tasks),{},X({},e.data.taskId,V({},r)))});case P:return n="description",(r=t.tasks[e.data.taskId]||{})[n]=e.data.value,V(V({},t),{},{tasks:V(V({},t.tasks),{},X({},e.data.taskId,V({},r)))});case _:return delete(r=t.tasks||{})[e.data.taskId],V(V({},t),{},{tasks:V({},r),currentTask:!1});default:return t}}),U);Y.subscribe((function(t){a("todo-state",t)})),new l("#app",{components:[x,W],store:Y}).render()})();